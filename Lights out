// Deze code is gemaakt door Koen van der Mije(s4809033) en Dylan Kusters (s4912926).

#include <iostream>
#include <fstream>
#include <climits>
#include <vector>

using namespace std;

class Puzzel {
public:
    int hoogte;
    int breedte;
    double percentage;
    char symboolLampAan;
    char symboolLampUit;
    char cursorSymbool;
    bool torusModus;
    int randomNum;
    vector<vector<int>> dePuzzel;

    Puzzel(int h = 5, int b = 5, double p = 50.0, char a = 'X', char u = '.', char c = ' ', bool t = false);
    int randomgetal();
    void maakschoon();
    void maakrandom();
    void drukaf();
    void setPercentage(double p);
    void setHoogte(int h);
    void setBreedte(int b);
};

// INFO BLOKJE
void infoBlokje() {
    cout << "Door Koen van der Mije(s4809033) en Dylan Kusters (s4912926) " << endl
         << "Begonnen met de studie Informatica aan de Universiteit Leiden in september 2025. " << endl
         << "Opdracht 3 voor het vak Programmeermethoden. " << endl
         << "Deadline : 10 november. " << endl
         << "Deze code doet blabla" << endl;
}

// Maakt een grote letter een kleine letter.
char maakKleineLetter(char a) {
    if (a >= 'A' && a <= 'Z') {
        return a + ('a' - 'A');
    } else {
        return a;
    }
}

// Leest een karakter in
char optieInlezen() {
    char k = cin.get();
    while (k == '\n') {
        k = cin.get();
    }
    cin.ignore(INT_MAX, '\n');
    return k;
}

// Leest een getal in (positief)
int leesGetal() {
    int getalbuffer = 0;
    bool heeftCijfer = false;
    char k;

    while (true) {
        if (!cin.get(k)) {
            break;
        }
        if (k >= '0' && k <= '9') {
            heeftCijfer = true;
            getalbuffer = (getalbuffer * 10) + (k - '0');
            if (getalbuffer > 9999) {
                getalbuffer = 9999;
            }
        } else {
            if (heeftCijfer) break;
        }
    }
    return getalbuffer;
}

//Maakt lamp aan of uit als het binnen de puzzel ligt.
void veranderSymbool(Puzzel& puzzel, int rij, int kolom){
    if (rij >= 0 && rij < puzzel.hoogte && kolom >= 0 && kolom < puzzel.breedte) {
        int arrayRij = puzzel.hoogte - 1 - rij;  // Draai rij om
        puzzel.dePuzzel[arrayRij][kolom] = (puzzel.dePuzzel[arrayRij][kolom] == 1 ? 0 : 1);
    }
}

void schakelCelOm(Puzzel& puzzel, int rij, int kolom) {
    veranderSymbool(puzzel, rij, kolom);
    
    int boven = rij - 1;
    int onder = rij + 1;
    int links = kolom - 1;
    int rechts = kolom + 1;
    
    if (puzzel.torusModus) {
        if (boven < 0) boven = puzzel.hoogte - 1;
        if (onder >= puzzel.hoogte) onder = 0;
        if (links < 0) links = puzzel.breedte - 1;
        if (rechts >= puzzel.breedte) rechts = 0;
        
        // Schakel alle naburige cellen om (in torus modus altijd geldig)
        veranderSymbool(puzzel, boven, kolom);
        veranderSymbool(puzzel, onder, kolom);
        veranderSymbool(puzzel, rij, links);
        veranderSymbool(puzzel, rij, rechts);
    } else {
        // Zonder torus modus: alleen omschakelen als in puzzel
        veranderSymbool(puzzel, boven, kolom);  
        veranderSymbool(puzzel, onder, kolom);  
        veranderSymbool(puzzel, rij, links);    
        veranderSymbool(puzzel, rij, rechts);  
    }
}

void volg(Puzzel& puzzel){
    // Van boven naar beneden door de visuele puzzel (behalve onderste rij)
    for (int rij = puzzel.hoogte - 1; rij > 0; rij--) {   
        for (int kolom = 0; kolom < puzzel.breedte; kolom++) {
            int arrayRij = puzzel.hoogte - 1 - rij;  // Converteer visuele rij naar array index
            
            if (puzzel.dePuzzel[arrayRij][kolom] == 1){  // lamp aan?
                schakelCelOm(puzzel, rij - 1, kolom);    // zet op cel ERONDER (rij - 1 in visuele coÃ¶rdinaten)
                puzzel.drukaf();
            }
        }
    }
}
// TEKEN SUBMENU
int tekensubmenu(Puzzel& puzzel) {
    char k;
    while (true) {
        cout << "Tekenmenu: Kies een optie: [T]erug, s[C]hoon, [R]andom of [G]enereer." << endl;
        k = optieInlezen();
        k = maakKleineLetter(k);
        switch (k) {
        case 'c':
            puzzel.maakschoon();
            break;
        case 'r':
            puzzel.maakrandom();
            break;
        case 'g':
            puzzel.drukaf();
            break;
        case 't':
            return 0;
        }
    }
}
//Puzzelmenu
int puzzelmenu(Puzzel& puzzel){
    char k;
    while (true){
        cout << "Puzzelmenu: [T]erug, [V]olg, [L]os op, [A]fspelen, [D]oe zet.\n";
        k = maakKleineLetter(optieInlezen());
        switch(k){
            case 't':
            return 0;
            case 'v':
            volg(puzzel);
        }
    }
}

// PARAMETERMENU
int parametermenu(Puzzel& puzzel) {
    char k;
    while (true) {
        cout << "Parametermenu: Kies een optie: [T]erug, [H]oogte, [B]reedte, [P]ercentage lampen" << endl;
        k = optieInlezen();
        k = maakKleineLetter(k);
        switch (k) {
        case 't':
            return 0;
        case 'h':
            cout << "Kies de hoogte van de puzzel." << endl;
            puzzel.setHoogte(leesGetal());
            cout << "Nieuwe hoogte is " << puzzel.hoogte << "." << endl;
            break;
        case 'b':
            cout << "Kies de breedte van de puzzel." << endl;
            puzzel.setBreedte(leesGetal());
            cout << "Nieuwe breedte is " << puzzel.breedte << "." << endl;
            break;
        case 'p':
            cout << "Kies het percentage lampen die aan staan bij random puzzels. " << endl;
            puzzel.setPercentage(leesGetal());
            cout << "Nieuw percentage is " << puzzel.percentage << "%." << endl;
            break;
        }
    }
}

// HOOFDMENU
int menu(Puzzel& puzzel) {
    char keuze;
    while (true) {
        cout << "Kies een optie: [P]arameters, p[U]zzelmenu, [T]ekenen of [S]toppen." << endl;
        keuze = optieInlezen();
        keuze = maakKleineLetter(keuze);
        switch (keuze) {
        case 's':
            return 1;
        case 'p':
            while (parametermenu(puzzel) != 0);
            break;
        case 'u':
            while (puzzelmenu(puzzel) != 0);
            break;
        case 't':
            while (tekensubmenu(puzzel) != 0);
            break;
        }
    }
}

// PUZZELMETHODES
Puzzel::Puzzel(int h, int b, double p, char a, char u, char c, bool t)
    : hoogte(h), breedte(b), percentage(p), symboolLampAan(a),
      symboolLampUit(u), cursorSymbool(c), torusModus(t) {
    randomNum = randomgetal();
    dePuzzel = vector<vector<int>>(hoogte, vector<int>(breedte, 0));
}

int Puzzel::randomgetal() {
    static int getal = 42;
    getal = (221 * getal + 1) % 1000;
    return getal;
}

void Puzzel::maakschoon() {
    for (int i = 0; i < hoogte; ++i) {
        for (int j = 0; j < breedte; ++j) {
            dePuzzel[i][j] = 0;
        }
    }
    cout << "Puzzel is leeggemaakt.\n";
}

void Puzzel::drukaf() {
    cout << "Puzzel (" << hoogte << "x" << breedte << ", " << percentage << "% aan):\n";
    for (int i = 0; i < hoogte; ++i) {
        for (int j = 0; j < breedte; ++j) {
            cout << (dePuzzel[i][j] ? symboolLampAan : symboolLampUit) << " ";
        }
        cout << endl;
    }
}

void Puzzel::maakrandom() {
    for (int i = 0; i < hoogte; ++i) {
        for (int j = 0; j < breedte; ++j) {
            int getal = randomgetal() % 100;  // Geeft een waarde tussen 0 en 99
            dePuzzel[i][j] = (getal < percentage) ? 1 : 0;
        }
    }
    cout << "Willekeurige puzzel gegenereerd.\n";
}

void Puzzel::setPercentage(double p) {
    percentage = (p >= 0 && p <= 100) ? p : 50;
}

void Puzzel::setHoogte(int h) {
    hoogte = (h > 0 && h <= 20) ? h : 5;
    dePuzzel.resize(hoogte, vector<int>(breedte, 0));
}

void Puzzel::setBreedte(int b) {
    breedte = (b > 0 && b <= 20) ? b : 5;
    for (auto& rij : dePuzzel) {
        rij.resize(breedte, 0);
    }
}

int main() {
    infoBlokje();
    Puzzel mijnPuzzel;
    mijnPuzzel.maakrandom();
    mijnPuzzel.drukaf();
    menu(mijnPuzzel);
    return 0;
}
